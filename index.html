<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>網路電台播放器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .station-item {
            transition: all 0.2s ease-in-out;
        }
        .station-item:hover, .station-item.playing {
            transform: scale(1.03);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
         .station-item.playing {
            border-color: #3b82f6; /* Blue-500 */
            background-color: #eff6ff; /* Blue-50 */
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl mx-auto bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden">
        <div class="p-6 md:p-8">
            <h1 class="text-3xl font-bold text-center mb-2 text-blue-600 dark:text-blue-400">網路電台播放器</h1>
            <p class="text-center text-gray-500 dark:text-gray-400 mb-6">選擇一個電台開始收聽</p>

            <!-- Now Playing Section -->
            <div id="player" class="bg-gray-50 dark:bg-gray-700 rounded-xl p-6 mb-6 text-center">
                 <div id="now-playing-artwork-container" class="mb-4">
                    <i class="fas fa-broadcast-tower text-6xl text-gray-300 dark:text-gray-500"></i>
                </div>
                <h2 id="now-playing" class="text-xl font-semibold truncate">未選擇電台</h2>
                <p id="player-status" class="text-sm text-gray-500 dark:text-gray-400">閒置中</p>

                <!-- Controls -->
                <div class="flex items-center justify-center space-x-6 mt-6">
                    <button id="prev-btn" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-backward-step fa-lg"></i>
                    </button>
                    <button id="play-pause-btn" class="w-16 h-16 rounded-full bg-blue-600 text-white flex items-center justify-center text-2xl hover:bg-blue-700 transition-transform transform hover:scale-110 shadow-lg">
                        <i id="play-pause-icon" class="fas fa-play"></i>
                    </button>
                     <button id="next-btn" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-forward-step fa-lg"></i>
                    </button>
                </div>

                <!-- Volume Control -->
                <div class="flex items-center justify-center space-x-2 mt-6 w-4/5 mx-auto">
                    <i class="fas fa-volume-down text-gray-500"></i>
                    <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.8" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-600">
                    <i class="fas fa-volume-up text-gray-500"></i>
                </div>
            </div>

            <!-- Station List -->
             <div>
                <h3 class="text-lg font-semibold mb-4">電台列表</h3>
                <div id="station-list" class="space-y-3 max-h-60 overflow-y-auto pr-2">
                    <!-- Stations will be dynamically inserted here -->
                </div>
            </div>

            <!-- Add Station -->
            <div class="mt-6">
                <h3 class="text-lg font-semibold mb-4">新增電台</h3>
                <div class="flex flex-col sm:flex-row gap-3">
                    <input type="text" id="station-name-input" placeholder="電台名稱" class="flex-grow p-3 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input type="url" id="station-url-input" placeholder="串流網址 (URL)" class="flex-grow p-3 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button id="add-station-btn" class="bg-green-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors">新增</button>
                </div>
                 <p id="error-message" class="text-red-500 text-sm mt-2"></p>
            </div>
        </div>
        <audio id="audio-player" preload="none"></audio>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const audioPlayer = document.getElementById('audio-player');
            const playPauseBtn = document.getElementById('play-pause-btn');
            const playPauseIcon = document.getElementById('play-pause-icon');
            const volumeSlider = document.getElementById('volume-slider');
            const nowPlaying = document.getElementById('now-playing');
            const playerStatus = document.getElementById('player-status');
            const stationList = document.getElementById('station-list');
            const addStationBtn = document.getElementById('add-station-btn');
            const stationNameInput = document.getElementById('station-name-input');
            const stationUrlInput = document.getElementById('station-url-input');
            const errorMessage = document.getElementById('error-message');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');

            let stations = [
                { name: 'ICRT (台灣)', url: 'https://stream.icrt.com.tw/icrt-128k' },
                { name: 'Hit FM 聯播網 (台北)', url: 'https://stream.rcs.revma.com/an1krh9g44puv' },
                { name: 'Kiss Radio (台灣)', url: 'https://kissradio.kissonair.com:8001/kiss' },
                { name: '寶島新聲 (台灣)', url: 'https://stream.superfm98-5.com.tw:8001/fm985' },
                { name: 'BBC World Service', url: 'https://stream.live.vc.bbcmedia.co.uk/bbc_world_service' },
                { name: 'K-POP Radio PN', url: 'https://stream.zeno.fm/f97b0u064hvvv' }
            ];

            let currentStationIndex = -1;

            const saveStations = () => {
                try {
                    localStorage.setItem('radioStations', JSON.stringify(stations));
                } catch (e) {
                    console.error("無法儲存電台:", e);
                }
            };

            const loadStations = () => {
                try {
                    const storedStations = localStorage.getItem('radioStations');
                    if (storedStations) {
                        stations = JSON.parse(storedStations);
                    }
                } catch (e) {
                    console.error("無法載入電台:", e);
                    // If loading fails, fall back to default
                    stations = [
                        { name: 'ICRT (台灣)', url: 'https://stream.icrt.com.tw/icrt-128k' },
                        { name: 'Hit FM 聯播網 (台北)', url: 'https://stream.rcs.revma.com/an1krh9g44puv' },
                        { name: 'Kiss Radio (台灣)', url: 'https://kissradio.kissonair.com:8001/kiss' },
                    ];
                }
            };

            const renderStationList = () => {
                stationList.innerHTML = '';
                stations.forEach((station, index) => {
                    const div = document.createElement('div');
                    div.className = `station-item p-4 border border-gray-200 dark:border-gray-600 rounded-lg flex justify-between items-center cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700`;
                    div.dataset.index = index;
                    
                    if (index === currentStationIndex) {
                        div.classList.add('playing');
                    }

                    div.innerHTML = `
                        <span class="font-medium">${station.name}</span>
                        <div class="flex items-center space-x-3">
                           <div class="status-icon"></div>
                           <button class="delete-station-btn text-red-500 hover:text-red-700 opacity-50 hover:opacity-100" data-index="${index}">
                             <i class="fas fa-trash-alt"></i>
                           </button>
                        </div>
                    `;
                    stationList.appendChild(div);
                });

                document.querySelectorAll('.station-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        if (e.target.closest('.delete-station-btn')) return;
                        const index = parseInt(item.dataset.index);
                        playStation(index);
                    });
                });
                
                document.querySelectorAll('.delete-station-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const index = parseInt(button.dataset.index);
                        deleteStation(index);
                    });
                });
            };
            
            const deleteStation = (index) => {
                if (!confirm(`確定要刪除 "${stations[index].name}" 嗎？`)) return;
                
                if (index === currentStationIndex) {
                    stopPlayback();
                    currentStationIndex = -1;
                } else if (index < currentStationIndex) {
                    currentStationIndex--;
                }
                
                stations.splice(index, 1);
                saveStations();
                renderStationList();
                updateControls();
            };

            const playStation = (index) => {
                if (index < 0 || index >= stations.length) return;
                
                currentStationIndex = index;
                const station = stations[index];
                audioPlayer.src = station.url;
                nowPlaying.textContent = station.name;
                
                document.querySelectorAll('.station-item').forEach(item => item.classList.remove('playing'));
                const currentStationItem = document.querySelector(`.station-item[data-index="${index}"]`);
                if (currentStationItem) {
                   currentStationItem.classList.add('playing');
                }

                audioPlayer.play().catch(e => {
                    console.error("播放錯誤:", e);
                    updateStatus('錯誤', true);
                });
                updateControls();
            };
            
            const stopPlayback = () => {
                audioPlayer.pause();
                audioPlayer.src = '';
                nowPlaying.textContent = '未選擇電台';
                updateStatus('閒置中');
                playPauseIcon.classList.remove('fa-pause');
                playPauseIcon.classList.add('fa-play');
                 document.querySelectorAll('.station-item').forEach(item => item.classList.remove('playing'));
            }

            const togglePlayPause = () => {
                if (audioPlayer.paused) {
                    if (currentStationIndex === -1 && stations.length > 0) {
                        playStation(0);
                    } else if (currentStationIndex !== -1) {
                         audioPlayer.play().catch(e => {
                            console.error("播放錯誤:", e);
                            updateStatus('錯誤', true);
                        });
                    }
                } else {
                    audioPlayer.pause();
                }
            };

            const updateStatus = (text, isError = false) => {
                playerStatus.textContent = text;
                playerStatus.classList.toggle('text-red-500', isError);
                playerStatus.classList.toggle('text-gray-500', !isError);
                
                const currentStationItem = document.querySelector(`.station-item.playing .status-icon`);
                 if(currentStationItem) {
                    if (text === '播放中...' || text === '緩衝中...') {
                        currentStationItem.innerHTML = `<div class="loader"></div>`;
                    } else if (isError) {
                        currentStationItem.innerHTML = `<i class="fas fa-exclamation-circle text-red-500"></i>`;
                    } else {
                        currentStationItem.innerHTML = '';
                    }
                 }
            };
            
            const updateControls = () => {
                prevBtn.disabled = currentStationIndex <= 0;
                nextBtn.disabled = currentStationIndex >= stations.length - 1;
            };

            playPauseBtn.addEventListener('click', togglePlayPause);
            
            prevBtn.addEventListener('click', () => {
                if (currentStationIndex > 0) {
                    playStation(currentStationIndex - 1);
                }
            });

            nextBtn.addEventListener('click', () => {
                if (currentStationIndex < stations.length - 1) {
                    playStation(currentStationIndex + 1);
                }
            });

            audioPlayer.addEventListener('play', () => {
                playPauseIcon.classList.remove('fa-play');
                playPauseIcon.classList.add('fa-pause');
                updateStatus('播放中...');
            });

            audioPlayer.addEventListener('pause', () => {
                playPauseIcon.classList.remove('fa-pause');
                playPauseIcon.classList.add('fa-play');
                updateStatus('已暫停');
            });
            
            audioPlayer.addEventListener('waiting', () => {
                updateStatus('緩衝中...');
            });
            
            audioPlayer.addEventListener('playing', () => {
                updateStatus('播放中...');
            });

            audioPlayer.addEventListener('error', () => {
                updateStatus('無法載入串流', true);
            });

            volumeSlider.addEventListener('input', (e) => {
                audioPlayer.volume = e.target.value;
            });
            
            addStationBtn.addEventListener('click', () => {
                const name = stationNameInput.value.trim();
                const url = stationUrlInput.value.trim();
                errorMessage.textContent = '';
                
                if (!name || !url) {
                    errorMessage.textContent = '電台名稱和網址不能為空。';
                    return;
                }
                
                try {
                    new URL(url);
                } catch (_) {
                    errorMessage.textContent = '請輸入有效的網址。';
                    return;
                }
                
                stations.push({ name, url });
                saveStations();
                renderStationList();
                stationNameInput.value = '';
                stationUrlInput.value = '';
                updateControls();
            });

            // Initial setup
            loadStations();
            renderStationList();
            updateControls();
            audioPlayer.volume = volumeSlider.value;
        });
    </script>
</body>
</html>
